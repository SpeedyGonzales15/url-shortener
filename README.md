# Сервис коротких ссылок

Сервис коротких ссылок позволяет пользователям сокращать URL-адреса, управлять ими и отслеживать их использование. Каждый пользователь может создавать уникальные короткие ссылки для своих оригинальных URL, а также управлять параметрами этих ссылок.

## Оглавление

- [Описание проекта](#описание-проекта)
- [Как пользоваться сервисом](#как-пользоваться-сервисом)
- [Поддерживаемые команды](#поддерживаемые-команды)
- [Тестирование кода](#тестирование-кода)
- [Документация по модулям](#документация-по-модулям)
- [Установка внешних библиотек](#установка-внешних-библиотек)

## Описание проекта

Проект реализован на Java с использованием фреймворка Spring Boot. Он включает в себя следующие основные компоненты:

1. **Модель `Url`**: Представляет собой сущность для хранения оригинального URL, короткого URL, идентификатора пользователя, времени жизни ссылки и лимита переходов.
2. **Репозиторий `UrlRepository`**: Интерфейс для взаимодействия с базой данных и выполнения операций CRUD.
3. **Сервис `UrlShortenerService`**: Содержит бизнес-логику для создания коротких ссылок, удаления устаревших ссылок и управления переходами.
4. **Контроллер `UrlShortenerController`**: Обрабатывает HTTP-запросы и взаимодействует с сервисами.

## Как пользоваться сервисом

1. Запустите приложение с помощью команды:
2. 
mvn spring-boot:run

3. Используйте API для создания коротких ссылок. Пример запроса:
4. 
curl -X POST "http://localhost:8080/api/shorten?originalUrl=http://example.com&userId=<UUID>&clickLimit=10"

Замените `<UUID>` на уникальный идентификатор пользователя.

## Поддерживаемые команды

На данный момент сервис поддерживает одну команду:

- `POST /api/shorten`: Создает короткую ссылку.
- **Параметры**:
 - `originalUrl` (String): Оригинальный URL для сокращения.
 - `userId` (UUID): Уникальный идентификатор пользователя.
 - `clickLimit` (int): Лимит переходов (по умолчанию 100).

## Тестирование кода

Для тестирования кода используются JUnit и Mockito. Для запуска тестов выполните следующую команду в корневой директории проекта:

mvn test

### Структура тестов

Тесты находятся в директории `src/test/java/com/example`. В проекте реализованы следующие тесты:

- **UrlShortenerServiceTest**: Тестирует функциональность сервиса сокращения ссылок.
  - `testShortenUrl()`: Проверяет, что метод сокращения ссылки возвращает корректный короткий URL и сохраняет его в репозитории.
  - `testDeleteExpiredUrls()`: Проверяет удаление устаревших ссылок (требует дополнительной настройки для проверки логики истечения срока действия).

## Документация по модулям

### Модуль `model.Url`

- **Описание**: Сущность для хранения информации о ссылках.
- **Поля**:
  - `id`: Уникальный идентификатор ссылки.
  - `originalUrl`: Оригинальный URL.
  - `shortUrl`: Сгенерированный короткий URL.
  - `userId`: Идентификатор пользователя.
  - `expirationDate`: Дата истечения срока действия ссылки.
  - `clickLimit`: Лимит переходов.
  - `clickCount`: Количество переходов.

### Модуль `repository.UrlRepository`

- **Описание**: Интерфейс для работы с базой данных.
- **Методы**:
  - `findAllByExpirationDateBefore(LocalDateTime now)`: Находит все ссылки, срок действия которых истек.
  - `findByShortUrl(String shortUrl)`: Находит ссылку по короткому URL.

### Модуль `service.UrlShortenerService`

- **Описание**: Содержит бизнес-логику для сокращения ссылок и управления ими.
- **Методы**:
  - `shortenUrl(String originalUrl, UUID userId, int clickLimit)`: Создает короткую ссылку.
  - `deleteExpiredUrls()`: Удаляет устаревшие ссылки.

### Модуль `controller.UrlShortenerController`

- **Описание**: Обрабатывает HTTP-запросы от клиентов.
- **Методы**:
  - `shortenUrl(...)`: Обрабатывает запрос на создание короткой ссылки.

## Установка внешних библиотек

В проекте используются следующие внешние библиотеки:

1. **Spring Boot**: Основной фреймворк для разработки приложения.
2. **H2 Database**: Временная база данных для хранения ссылок.

Эти библиотеки указаны в файле `pom.xml`, и Maven автоматически загрузит их при сборке проекта. Убедитесь, что у вас установлен Maven и JDK версии 17 или выше.
